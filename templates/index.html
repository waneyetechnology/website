{% extends "base.html" %}

{% block content %}
<!-- Mobile-only Financial Analysis Section (appears before headlines on mobile) -->
<div class='d-lg-none mb-4' id='financialAnalysisMobileContainer'>
    <div class='card shadow-sm'>
        <div class='card-header bg-secondary text-white d-flex justify-content-between align-items-center'>
            <span class='fw-bold'>
                <i class='fas fa-robot me-1 financial-analysis-icon-left'></i>Financial Analysis
            </span>
            <i class='fas fa-chevron-down financial-analysis-icon-right'></i>
        </div>
        
        <div class='card-body px-3 py-3 collapse' id='financialAnalysisContentMobile'>
            {% include 'financial_analysis.html' %}
        </div>
    </div>
</div>

<div class='row g-4 headlines-analysis-row'>
    <!-- Headlines Section -->
    <div class='col-lg-8'>
        <div class='card shadow-sm'>
            <div class='card-header bg-primary text-white'>
                <span class='fw-bold'>Top Financial Headlines</span>
            </div>

            <!-- News Headlines Section -->
            <div class='card-body px-3 py-4'>
                <div class='headline-grid'>
                    {% for item in news %}
                        {% set item_index = loop.index0 %}
                        {% include 'headline_card.html' %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Analysis Section (Desktop Only) -->
    <div class='col-lg-4 d-none d-lg-block' id='financialAnalysisColumn'>
        <div class='card shadow-sm h-100'>
            <div class='card-header bg-secondary text-white d-flex justify-content-between align-items-center'>
                <span class='fw-bold'>
                    <i class='fas fa-robot me-1 financial-analysis-icon-left'></i>Financial Analysis
                </span>
                <i class='fas fa-chevron-down financial-analysis-icon-right'></i>
            </div>
            
            <div class='card-body px-3 py-3' id='financialAnalysisContent'>
                {% include 'financial_analysis.html' %}
            </div>
        </div>
    </div>
</div>

<div class='row g-4 mt-2'>
    <div class='col-md-4'>
        <div class='card shadow-sm'>
            <div class='card-header bg-info text-white'>Central Banks</div>
            
            <!-- US Federal Reserve subsection -->
            {% if fed_econ_data %}
            <div class='card-body p-3'>
                <h6 class='card-subtitle mb-2 text-muted'>US Federal Reserve - Economy at a Glance</h6>
                <div class='small'>
                    {% for item in fed_econ_data %}
                    <div class='mb-1'><strong>{{ item.indicator }}:</strong> {{ item.value }}</div>
                    {% endfor %}
                </div>
            </div>
            <hr class='my-0'>
            {% endif %}
            
            <!-- Central Bank Rates -->
            <div class='card-body p-3'>
                <h6 class='card-subtitle mb-2 text-muted'>Policy Rates</h6>
                <ul class='list-group list-group-flush'>
                    {% for policy in policies %}
                    <li class='list-group-item px-0'><b>{{ policy.bank }}:</b> {{ policy.rate }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    
    <div class='col-md-4'>
        <div class='card shadow-sm'>
            <div class='card-header bg-success text-white'>Key Economic Data</div>
            <div class='card-body'>
                {% for item in econ %}
                <div class='mb-3'>
                    <div class='d-flex justify-content-between align-items-center mb-1'>
                        <span class='fw-bold small'>{{ item.event }}</span>
                        <span class='badge bg-{% if item.sentiment == "positive" %}success{% elif item.sentiment == "negative" %}danger{% else %}secondary{% endif %}'>{{ item.value }}</span>
                    </div>
                    <div class='progress' style='height: 10px;'>
                        {% set percentage = (item.numeric_value / item.max_value) * 100 %}
                        <div class='progress-bar bg-{% if item.sentiment == "positive" %}success{% elif item.sentiment == "negative" %}danger{% else %}secondary{% endif %}' role='progressbar' style='width: {{ percentage }}%;' aria-valuenow='{{ item.numeric_value }}' aria-valuemin='0' aria-valuemax='{{ item.max_value }}'></div>
                    </div>
                    <small class='text-muted'>{{ item.date }}</small>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class='col-md-4'>
        <div class='card shadow-sm'>
            <div class='card-header bg-warning text-dark'>Forex CFD Quotes</div>
            <div class='table-responsive'>
                <table class='table table-bordered mb-0'>
                    <thead class='table-light'>
                        <tr>
                            <th>Pair</th>
                            <th>Bid</th>
                            <th>Ask</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in forex %}
                        <tr>
                            <td>{{ item.pair }}</td>
                            <td>{{ item.bid }}</td>
                            <td>{{ item.ask }}</td>
                            <td class='{% if item.change > 0 %}text-success{% elif item.change < 0 %}text-danger{% endif %}'>
                                {% if item.change > 0 %}<i class='fas fa-arrow-up'></i>{% elif item.change < 0 %}<i class='fas fa-arrow-down'></i>{% endif %}
                                {{ item.change }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
